// step 2 testing if db is working or not with raw data
// app.get("/test", async (req, res) => {
//     let test1 = new Listing({
//         title: "home27",
//         description: "This home is own by dnyanu sonawane",
//         price: 5000,
//         location: "Thane",
//         country: "India",
//     });
//     await test1.save();
//     console.log(test1);
//     res.send("sucessful testing");
// })



// <% if(currUser && currUser._id.equals(lists.owner._id)){%>
//                 <div class="btns">
//                     <a href="/listings/<%= lists._id %>/edit" class="btn btn-dark col-1 offset-3 add-btn">Edit</a>
//                     <form action="/listings/<%= lists._id %>?_method=DELETE" method="post">
//                         <button class="btn btn-dark offset-3"> Delete</button>
//                     </form>
//                 </div>
//                 <%}%>

// app.get("/demo",async(req,res)=>{
//     let fuser= new User({
//         email:"abcd@gmail.com",
//         username:"delta=alpha"
//     });
//     let newuser= await User.register(fuser,"august");
//     res.send(newuser);
// })


  img: {
        // type: String,
        url: String,
        filename: String,
        default: "https://images.unsplash.com/photo-1533619239233-6280475a633a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fHNreSUyMHZhY2F0aW9ufGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60",

        set: (v) => v === "" ? "https://images.unsplash.com/photo-1533619239233-6280475a633a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fHNreSUyMHZhY2F0aW9ufGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60" : v,
    },

    
        img: {
        type: String,
        default: "https://images.unsplash.com/photo-1533619239233-6280475a633a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fHNreSUyMHZhY2F0aW9ufGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60",

        set: (v) => v === "" ? "https://images.unsplash.com/photo-1533619239233-6280475a633a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTR8fHNreSUyMHZhY2F0aW9ufGVufDB8fDB8fHww&auto=format&fit=crop&w=800&q=60" : v,
    },


    const express = require("express");
const router = express.Router();
const Listing = require("../datamodels/listing.js");
const wrapAsync = require("../utils/wrapAsync.js");
const ExpressEror = require("../utils/ExpressError.js");
const { isLoggedIn, isOwner ,validateListings} = require("../middleware.js");
const listingcontroller=require("../controllers/listingController.js");

//Here we dont have access of app hence we are using router instead of app.get/post...

// step 4  ejs setup and index route 
router.route("/")
.get("/", wrapAsync(listingcontroller.index));

// 6 create new lists
router.get("/new", isLoggedIn, listingcontroller.renderNewForm);

// step 5 show route read individual place 
router.get("/:id", wrapAsync(listingcontroller.showListings));

// 7 submit list route
router.post("/", isLoggedIn, validateListings, wrapAsync(listingcontroller.submitListing));

// 8 edit route
router.get("/:id/edit", isLoggedIn, isOwner, wrapAsync(listingcontroller.edit));

//9 update
router.put("/:id", isLoggedIn, isOwner, wrapAsync(listingcontroller.update));

//10 delete listings 
router.delete("/:id", isLoggedIn, isOwner, wrapAsync(listingcontroller.delete));

module.exports = router;

const express = require("express");
const router = express.Router({ mergeParams: true });
const User = require("../datamodels/user.js");
const wrapAsync = require("../utils/wrapAsync");
const passport = require("passport");
const { saveRedirectUrl } = require("../middleware.js");
const usercontroller=require("../controllers/userController.js");

//signup
router.route("/signup")
.get("/signup",usercontroller.signup);

//after submitting signup form
router.post("/signup", wrapAsync(usercontroller.submitSignup));

//login 
router.get("/login", usercontroller.login);

//after login 
router.post("/login", saveRedirectUrl,
    passport.authenticate('local', { failureRedirect: '/login', failureFlash: true }),
    usercontroller.submitLogin);
    
//logout
router.get("/logout", usercontroller.logout);

module.exports = router;